<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    Departamento de Información y Servicio Voluntario
  </title>
  <meta name="description" content=" Departamento de Información y Servicio Voluntario" />
  <meta name="keywords" content=" Departamento de Información y Servicio Voluntario" />

  <!-- Bootstrap CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <!-- Icons-->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <link rel="stylesheet" href="servicios.css" />


<body>
  <section id="servicios" class="servicios" style=" background-color: var(--bgseccion-dentro)">
    <div class="container">
      <div class="text-center mb-5">
        <h2 class="display-4 fw-bold text-primary">Servicios Locales</h2>
        <p class="lead text-muted">
          Consulta los servicios según tu asamblea
        </p>
      </div>

      <div class="assembly-selector-container mb-5" style="margin-bottom: 4rem;">
        <div class="assembly-cards-wrapper">
          <div class="assembly-card active" data-assembly="asamblea1" onclick="selectAssembly('asamblea1')">
            <h4 class="assembly-title">Mar de Ajó 1</h4>
            <p class="assembly-date">17 al 19 de Octubre de 2025</p>
          </div>
          <div class="assembly-card" data-assembly="asamblea2" onclick="selectAssembly('asamblea2')">
            <h4 class="assembly-title">Mar de Ajó 2</h4>
            <p class="assembly-date">25 al 27 de Octubre de 2025</p>
          </div>
        </div>
      </div>


      <!-- Filter Tabs -->
      <div class="filter-tabs">
        <button class="filter-tab active" data-filter="all">Todos los servicios</button>
        <button class="filter-tab" data-filter="restaurante">Restaurantes</button>
        <button class="filter-tab" data-filter="hotel">Alojamientos</button>
        <button class="filter-tab" data-filter="centroSalud">Centros de Salud</button>
        <button class="filter-tab" data-filter="farmacia">Farmacias</button>
        <button class="filter-tab" data-filter="cajero">Cajeros Automáticos</button>
      </div>
      <div class="filter-localidad-tabs">
        <button class="filter-localidad-tab active" data-filter="all">Todas las localidades</button>
        <button class="filter-localidad-tab" data-filter="teresita">Santa Teresita</button>
        <button class="filter-localidad-tab" data-filter="tuyu">Mar del Tuyú</button>
        <button class="filter-localidad-tab" data-filter="tuyu">Mar del Tuyú</button>
        <button class="filter-localidad-tab" data-filter="costa">Costa del Este</button>
        <button class="filter-localidad-tab" data-filter="aguas">Aguas Verdes</button>
        <button class="filter-localidad-tab" data-filter="lucila">Lucila del Mar</button>
        <button class="filter-localidad-tab" data-filter="bernardo">San Bernardo</button>
        <button class="filter-localidad-tab" data-filter="ajo">Mar de Ajó</button>
        <button class="filter-localidad-tab" data-filter="ajo">Mar de Ajó</button>
        <button class="filter-localidad-tab" data-filter="atlantis">Nueva Atlantis</button>
        <button class="filter-localidad-tab" data-filter="medanos">Punta Medanos</button>
        <button class="filter-localidad-tab" data-filter="pinamar">Pinamar</button>
        <button class="filter-localidad-tab" data-filter="carilo">Cariló</button>
      </div>

      <!-- Amenities List -->
      <div class="row g-4" id="amenities-list"></div>
    </div>
  </section>

  <script>
    // Cargamos los servicios desde un archivo JSON externo
    fetch('./servicios.json')
      .then(response => response.json())
      .then(data => {
        // Guardamos los servicios en una variable global accesible en toda la página
        window.globalEventData = data;

        // Notificar que los datos están cargados
        document.dispatchEvent(new Event('dataLoaded'));
      })
      .catch(error => console.error('Error loading servicios.json:', error));
  </script>

  <script>
    // ---- Smooth scrolling (desplazamiento suave al hacer click en un enlace con #) ----
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault(); // Evitamos el comportamiento por defecto del enlace
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          // Desplazamiento suave hacia la sección objetivo
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // ---- Seleccionar una asamblea (tarjeta) ----
    function selectAssembly(assemblyId) {
      const wrapper = document.querySelector('.assembly-cards-wrapper');

      // Agregar clase para indicar que hay una selección activa
      wrapper.classList.add('has-selection');

      // Quitar clase 'active' de todas las cards
      document.querySelectorAll('.assembly-card').forEach(card => {
        card.classList.remove('active');
      });

      // Marcar la card seleccionada como 'active'
      document.querySelector(`[data-assembly="${assemblyId}"]`).classList.add('active');

      // Mensaje en consola (debug)
      console.log(`Asamblea seleccionada: ${assemblyId}`);

      // Disparar un evento personalizado para notificar a otros componentes
      const event = new CustomEvent('assemblyChanged', {
        detail: { assemblyId: assemblyId }
      });
      document.dispatchEvent(event);
    }

    // ---- Resetear selección (volver al estado inicial) ----
    function resetAssemblySelection() {
      const wrapper = document.querySelector('.assembly-cards-wrapper');
      wrapper.classList.remove('has-selection');

      // Quitar la clase 'active' de todas las cards
      document.querySelectorAll('.assembly-card').forEach(card => {
        card.classList.remove('active');
      });
    }

    // Estado inicial: sin ninguna asamblea seleccionada
    document.addEventListener('DOMContentLoaded', function () {
      // console.log('Selector de asambleas inicializado sin selección');

      // Auto seleccionar asamblea1 si la fecha actual es anterior al 21 de Octubre de 2025
      const currentDate = new Date();
      const cutoffDate = new Date('2025-10-21T00:00:00');
      if (currentDate < cutoffDate) {
        selectAssembly('asamblea1');
      } else {
        selectAssembly('asamblea2');
      }
    });

    // ---- Filtro por categoría de servicios ----
    document.querySelectorAll('.filter-tab').forEach(btn => {
      btn.addEventListener('click', function () {
        if (!window.globalEventData) return; // Esperar a que los datos estén cargados

        // Quitar 'active' de todos los filtros y aplicar solo al seleccionado
        document.querySelectorAll('.filter-tab').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        const parentFilter = this.dataset.filter; // Categoría seleccionada
        const localidadTab = document.querySelector(".filter-localidad-tab.active");
        const localidadFilter = localidadTab ? localidadTab.dataset.filter : 'all';

        // Mostrar todos los servicios si se selecciona "all"
        if (parentFilter === "all") {
          if (localidadFilter === "all") {
            renderAmenities2(window.globalEventData);
          } else {
            renderAmenities2(window.globalEventData.filter(x => x.localidad.toLowerCase() === localidadFilter.toLowerCase()));
          }
        }
        else {
          // Filtrar solo por categoría
          if (localidadFilter === "all") {
            renderAmenities2(window.globalEventData.filter(i => i.categoria === parentFilter));
          } else {
            renderAmenities2(window.globalEventData.filter(x => x.categoria === parentFilter && x.localidad.toLowerCase() === localidadFilter.toLowerCase()));
          }
        }
      });
    });

    // ---- Filtro por localidad ----
    document.querySelectorAll('.filter-localidad-tab').forEach(btn => {
      btn.addEventListener('click', function () {
        if (!window.globalEventData) return; // Esperar a que los datos estén cargados

        // Quitar 'active' de todos los filtros de localidad y aplicar solo al seleccionado
        document.querySelectorAll('.filter-localidad-tab').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        const filterParentTab = document.querySelector(".filter-tab.active");
        const localidadFilter = this.dataset.filter; // Localidad seleccionada
        const parentFilter = filterParentTab ? filterParentTab.dataset.filter : 'all'; // Categoría activa

        if (parentFilter === "all") {
          if (localidadFilter === "all") {
            // Mostrar todo si no hay filtros
            renderAmenities2(window.globalEventData);
          }
          else {
            // Filtrar solo por localidad
            let filteredList = window.globalEventData.filter(x => x.localidad?.toLowerCase().includes(localidadFilter.toLowerCase()));
            renderAmenities2(filteredList);
          }
        }
        else {
          if (localidadFilter === "all") {
            // Filtrar solo por categoría
            renderAmenities2(window.globalEventData.filter(i => i.categoria === parentFilter));
          }
          else {
            // Filtrar por localidad Y categoría
            let filteredList = window.globalEventData.filter(
              x =>
                x.localidad?.toLowerCase().includes(localidadFilter.toLowerCase()) &&
                x.categoria === parentFilter
            );
            renderAmenities2(filteredList);
          }
        }
      });
    });

    // ---- Función para obtener icono según categoría ----
    function getIcon(categoria) {
      switch (categoria) {
        case 'farmacia': return 'fa-pills';
        case 'hotel': return 'fa-hotel';
        case 'restaurante': return 'fa-utensils';
        case 'centroSalud': return 'fa-hospital';
        case 'cajero': return 'fa-credit-card';
        default: return 'fa-home';
      }
    }

    // ---- Renderizado de servicios (amenities) ----
    function renderAmenities2(amenitiesData) {
      const container = document.getElementById("amenities-list");
      container.innerHTML = ""; // Limpiar la lista antes de renderizar

      amenitiesData.forEach((item) => {
        if (item.actions) {
          // (Opcional) Renderizar botones adicionales si el servicio tiene acciones definidas
          const actions = item.actions
            .map(
              (action) =>
                `<button class="btn btn-sm btn-outline-primary">${action.label}</button>`,
            )
            .join("");
        }

        // Plantilla HTML de cada servicio
        const html = `
           <div class="col-lg-${amenitiesData.length == 1 ? "12" : "6"} amenity-item-wrapper" data-category="${item.categoria}">
              <div class="amenity-card">
                  <div class="amenity-header">
                      <div class="amenity-icon">
                          <i class="fas ${getIcon(item.categoria)}"></i>
                      </div>
                      <div>
                          <h5 class="amenity-title">${item.titulo}</h5>
                      </div>
                  </div>
                  <p style="color: var(--calm-text-light); margin-bottom: 16px;">Elige alguna de las siguientes opciones para ver la información.</p>
                  <div class="amenity-actions">
                      <a href="${item.link1 || '#'}" class="calm-btn-sm" target="_blank">Google Maps</a>
                      <a href="${item.link1 || '#'}" class="calm-btn-sm" target="_blank">Sitio de la Municipalidad</a>
                  </div>
              </div>
          </div>
        `;
        container.insertAdjacentHTML("beforeend", html);
      });
    }

    // ---- Cuando los datos estén cargados ----
    document.addEventListener('dataLoaded', function () {
      // Renderizar los servicios iniciales
      renderAmenities2(window.globalEventData);
    });
  </script>

</body>
</head>